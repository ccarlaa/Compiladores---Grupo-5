name: Verifica√ß√£o de Depend√™ncias

on:
  schedule:
    - cron: '0 6 * * 1'  # Toda segunda-feira √†s 6h UTC
  workflow_dispatch:

jobs:
  check-dependencies:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        
    steps:
    - name: Checkout do c√≥digo
      uses: actions/checkout@v4
      
    - name: Verificar ferramentas essenciais
      run: |
        echo "=== Verifica√ß√£o de Depend√™ncias - ${{ matrix.os }} ==="
        
        # Verificar GCC
        if command -v gcc >/dev/null 2>&1; then
          echo "‚úÖ GCC encontrado: $(gcc --version | head -n1)"
        else
          echo "‚ùå GCC n√£o encontrado"
        fi
        
        # Verificar Make (quando dispon√≠vel)
        if command -v make >/dev/null 2>&1; then
          echo "‚úÖ Make encontrado: $(make --version | head -n1)"
        else
          echo "‚ö†Ô∏è Make n√£o encontrado (opcional)"
        fi
        
        # Verificar Git
        if command -v git >/dev/null 2>&1; then
          echo "‚úÖ Git encontrado: $(git --version)"
        else
          echo "‚ùå Git n√£o encontrado"
        fi
      shell: bash
      
    - name: Teste de compila√ß√£o m√≠nima
      run: |
        echo "=== Teste de Compila√ß√£o ==="
        gcc -std=c99 -Wall -Wextra -DMANUAL_MODE -o test_compile src/main.c
        
        if [ -f "test_compile" ] || [ -f "test_compile.exe" ]; then
          echo "‚úÖ Compila√ß√£o bem-sucedida"
        else
          echo "‚ùå Falha na compila√ß√£o"
          exit 1
        fi
      shell: bash
      
    - name: Criar relat√≥rio
      run: |
        echo "## üìã Relat√≥rio de Depend√™ncias - ${{ matrix.os }}" >> dependency_report.md
        echo "" >> dependency_report.md
        echo "- **Sistema**: ${{ matrix.os }}" >> dependency_report.md
        echo "- **Data**: $(date)" >> dependency_report.md
        echo "- **GCC**: $(gcc --version | head -n1)" >> dependency_report.md
        echo "- **Status**: ‚úÖ Funcional" >> dependency_report.md
        echo "" >> dependency_report.md
      shell: bash
      
    - name: Upload do relat√≥rio
      uses: actions/upload-artifact@v4
      with:
        name: dependency-report-${{ matrix.os }}
        path: dependency_report.md
